/*
 * jQuery News Viewer Plugin for WYSIWYG Web Builder 9
 * Copyright Pablo Software solutions 2013
 * http://www.wysiwygwebbuilder.com/
 */
(function(d){function k(d){return 10>d?"0"+d:d}function j(f,a,b,c,l,g){a=d("<a></a>").attr("href",a).attr("target",g.target).html(b);a=d("<h4></h4>").append(a);if(g.includeDate){b=new Date(c);if("twitter"==g.dateFormat)c=parseInt(((new Date).getTime()-b.getTime())/1E3),c=60>c?"less than a minute ago":120>c?"about a minute ago":3600>c?parseInt(c/60).toString()+" minutes ago":7200>c?"about an hour ago":86400>c?"about "+parseInt(c/3600).toString()+" hours ago":172800>c?"1 day ago":parseInt(c/86400).toString()+
" days ago";else{var m="January February March April May June July August September October November December".split(" "),q="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),e=b.getFullYear(),n=e.toString().substring(2),r=b.getMonth()+1,v=b.getDate(),j=b.getHours(),h=b.getMinutes(),p=b.getSeconds();c=g.dateFormat;c=c.replace("hh",k(j));c=c.replace("h",j);c=c.replace("nn",k(h));c=c.replace("n",h);c=c.replace("ss",k(p));c=c.replace("s",p);c=c.replace("yy",e);c=c.replace("y",n);c=
c.replace("mm",k(r));c=c.replace("m",r);c=c.replace("dd",k(v));c=c.replace("d",v);c=c.replace("DD","X1");c=c.replace("D","X2");c=c.replace("MM","X3");c=c.replace("M","X4");c=c.replace("X1",q[b.getDay()]);c=c.replace("X2",q[b.getDay()].substring(0,2));c=c.replace("X3",m[r-1]);c=c.replace("X4",m[r-1].substring(0,3))}c=d("<div></div>").addClass("publication-date").text(c)}else c=d("<div></div>");l=d("<div></div>").addClass("summary").html(l);a=d("<div></div>").addClass("headline").append(a,c,l,"");1>=
g.animation&&"rotate"==g.mode&&a.css({opacity:0});0==g.sortOrder?a.appendTo(f):a.prependTo(f)}function h(f,a){var b="#"+f.attr("id")+" .headline";if("default"==a.mode)f.css("overflow-y","auto"),d(b).css("position","relative"),d(b).css("height","auto"),d(b).css("top","0");else if("rotate"==a.mode){var c=0,l=0,g=0,m=f.css("padding-left");if(0==a.animation||1==a.animation)d(b).eq(c).css({opacity:1});else if(2==a.animation||3==a.animation)g=f.outerWidth(),3==a.animation&&(g=-g),d(b).css("left",g),d(b).eq(c).css("left",
m);else if(4==a.animation||5==a.animation)d(b).eq(c).css("top",m),g=f.outerHeight(),5==a.animation&&(g=-g);var q=d(b).length,e,n=!1,j={},h={},k=function(){if(!n){n=!0;e=!1;c=(l+1)%q;if(0==a.animation||1==a.animation)j={opacity:0},h={opacity:1};else if(2==a.animation||3==a.animation)j={left:-g},h={left:m};else if(4==a.animation||5==a.animation)j={top:-g},h={top:m};d(b).eq(l).animate(j,a.animationDuration,function(){2==a.animation||3==a.animation?d(this).css("left",g):(4==a.animation||5==a.animation)&&
d(this).css("top",g)});d(b).eq(c).animate(h,a.animationDuration,function(){n=!1;e||(e=setTimeout(k,a.pause))});l=c}};e||(e=setTimeout(k,a.pause));f.hover(function(){clearTimeout(e);e=!1},function(){e||(e=setTimeout(k,250))})}else if("scroller"==a.mode)d(b).css("position","relative"),d(b).css("height","auto"),d(b).css("top","0"),a.ticker_height=f.height(),a.news_height=a.container.height(),a.line_count=0,a.rotate=!0,f.hover(function(){a.rotate=!1},function(){a.rotate=!0}),w(f,a);else if("paginate"==
a.mode){f.css("overflow-y","auto");d(b).css("position","relative");d(b).css("height","auto");d(b).css("top","0");for(var t=0,p=function(){f.find(".headline").hide().slice(t*a.numPerPage,(t+1)*a.numPerPage).show()},u=f.find(".headline").length,u=Math.ceil(u/a.numPerPage),x=d('<div class="pager"></div>'),s=0;s<u;s++)d('<span class="page-number"></span>').text(s+1).bind("click",{newPage:s},function(a){t=a.data.newPage;p();d(this).addClass("active").siblings().removeClass("active")}).appendTo(x).addClass("clickable");
x.prependTo(f).find("span.page-number:first").addClass("active");p()}else"ticker"==a.mode&&(d(b).css("position","relative"),d(b).css("height","auto"),d(b).css("top","0"),y(f,a))}function w(f,a){a.line_count+=a.rotate?-2:0;d("p",f).css("top",a.line_count);a.line_count<-1*a.news_height&&(a.line_count=a.ticker_height);setTimeout(function(){w(f,a)},a.speed)}function y(d,a){d.find(".headline:last").clone().prependTo(d).css("display","none");d.find(".headline:first").fadeIn(1E3).slideDown(500);d.find(".headline:last").fadeOut().remove();
setTimeout(function(){y(d,a)},a.pause)}d.fn.newsviewer=function(f){var a=d.extend({animation:0,animationDuration:500,dataSource:"local",dateFormat:"yy/mm/dd",facebook_access_token:"",facebook_post_types:["status","photo","link"],includeDate:!0,maxItems:10,mode:"default",numPerPage:1,param:null,pause:5E3,sortOrder:0,speed:50,target:"_self",url:null},f);return this.each(function(){d.newsviewer(d(this),a)})};d.newsviewer=function(f,a){f.empty();"scroller"==a.mode&&d("<p></p>").css("position","relative").appendTo(f);
a.container=f;"scroller"==a.mode&&(a.container=d("p",f));if("local"==a.dataSource){if(null!=a.param)for(var b=0;b<a.param.length;b++)j(a.container,a.param[b][0],a.param[b][1],a.param[b][2],a.param[b][3],a);h(f,a)}else if("rss"==a.dataSource){var c=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f);d.get(a.url,function(b){c.remove();1==d("feed",b).length?d("feed entry",b).each(function(c){if(c>=a.maxItems)return!1;j(a.container,d("link",this).text(),
d("title",this).text(),d("updated",this).text(),d("content",this).text(),a)}):d("rss item",b).each(function(c){if(c>=a.maxItems)return!1;j(a.container,d("link",this).text(),d("title",this).text(),d("pubDate",this).text(),d("description",this).text(),a)});h(f,a)})}else"twitter"==a.dataSource?(c=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),d.getJSON(a.url,function(b){c.remove();d.each(b,function(d,c){var b=c.created_at.split(" "),b=Date.parse(b[1]+
" "+b[2]+", "+b[5]+" "+b[3]),e=c.text.replace(/((http|https):\/\/\S+)/g,'<a target="_blank" href="$1">$1</a>'),e=e.replace(/\@(\w+)/g,'<a target="_blank" href="http://twitter.com/$1">@$1</a>');j(a.container,"http://twitter.com/"+a.param,e,b,"",a)});h(f,a)})):"twittersearch"==a.dataSource?(c=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),d.getJSON(a.url,function(b){c.remove();d.each(b.statuses,function(c,d){var b=d.created_at.split(" "),b=Date.parse(b[1]+
" "+b[2]+", "+b[5]+" "+b[3]),e=d.text.replace(/(http:\/\/\S+)/g,'<a target="_blank" href="$1">$1</a>'),e=e.replace(/\@(\w+)/g,'<a target="_blank" href="http://twitter.com/$1">@$1</a>');j(a.container,"http://www.twitter.com/"+d.user.screen_name,'<img style="border-width:0;padding:0px 10px 10px 0px;float:left;" src="'+d.user.profile_image_url+'">'+e,b,"",a)});h(f,a)})):"facebook"==a.dataSource?(c=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),
b="https://graph.facebook.com/"+a.param,b=b+"/feed?access_token="+a.facebook_access_token,b+="&limit=",b+=a.maxItems,b+="&callback=?",d.getJSON(b,function(b){c.remove();d.each(b.data,function(c,b){if(0<=d.inArray(b.type,a.facebook_post_types)){var f=new Date((b.created_time||"").replace(/-/g,"/").replace(/TZ/g," "));(new Date).getTime();f.getTime();var e="",h=a.param;null!=b.from&&(h=b.from.name);void 0!=b.message?e=b.message:void 0!=b.story&&(e=b.story);"link"==b.type&&-1==e.indexOf(b.link)&&(""!=
e&&(e+="<br>"),e+=b.link);e=e.replace(/\b((http|https):\/\/\S+)/g,'<a target="_blank" href="$1">$1</a>');"photo"==b.type&&(e+='<div class="picture">',void 0!=b.link&&(e=e+'<a href="'+b.link,e+='" target="_blank">'),e+='<img src="',e+=b.picture,e+='">',void 0!=b.link&&(e+="</a>"),e+="</div>");j(a.container,"http://www.facebook.com/profile.php?id="+a.param,h,f,e,a)}});h(f,a)})):"flickr"==a.dataSource&&(c=d("<img/>").attr({src:"wb.newsviewer.gif",alt:"Loading. Please wait."}).addClass("news-wait").appendTo(f),
b="http://api.flickr.com/services/feeds/photos_public.gne?format=json&",null!=a.param&&(b+=a.param,b+="&"),b+="jsoncallback=?",d.getJSON(b,function(b){c.remove();d.each(b.items,function(b,c){var f=d("<a></a>").attr("href",c.link).attr("target",a.target).text(c.title),f=d("<h4></h4>").append(f),e=d("<div></div>").addClass("publication-date").text(c.author.split("(")[1].replace(")","")),h=d("<img>").attr("src",c.media.m);d("<div></div>").addClass("headline").append(f,e,h,"").appendTo(a.container);if(b==
a.maxItems)return!1});h(f,a)}))}})(jQuery);